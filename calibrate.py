"""
calibrate.py - –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º—ã—à–∏

1. –í—Å—Ç–∞–Ω—å –≤ –∏–≥—Ä–µ, —Å–º–æ—Ç—Ä–∏ –Ω–∞ –°–ï–í–ï–† (yaw = 180¬∞)
2. –ó–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç
3. –û–Ω –ø–æ–≤–µ—Ä–Ω—ë—Ç —Ç–µ–±—è - –∑–∞–º–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
4. –ü–æ–¥–±–µ—Ä–∏ MOUSE_SENSITIVITY
"""

import time
from pico_controller import PicoController

PICO_PORT = "COM4"

# –°–∫–æ–ª—å–∫–æ –ø–∏–∫—Å–µ–ª–µ–π = 90 –≥—Ä–∞–¥—É—Å–æ–≤?
TEST_PIXELS = 500

pico = PicoController(PICO_PORT)

print("="*50)
print("üéØ –ö–ê–õ–ò–ë–†–û–í–ö–ê –ß–£–í–°–¢–í–ò–¢–ï–õ–¨–ù–û–°–¢–ò")
print("="*50)

if not pico.connect():
    print("‚ùå Pico –Ω–µ –Ω–∞–π–¥–µ–Ω!")
    exit()

print("‚úÖ Pico –ø–æ–¥–∫–ª—é—á–µ–Ω")

print(f"""
üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø:
1. –ó–∞–π–¥–∏ –≤ Minecraft
2. –û—Ç–∫—Ä–æ–π F3
3. –ü–æ–≤–µ—Ä–Ω–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Ç–∞–∫, —á—Ç–æ–±—ã yaw = 180.0¬∞ (—Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ –°–ï–í–ï–†)
4. –ù–∞–∂–º–∏ Enter —Ç—É—Ç
5. –°–∫—Ä–∏–ø—Ç –ø–æ–≤–µ—Ä–Ω—ë—Ç –º—ã—à—å –Ω–∞ {TEST_PIXELS} –ø–∏–∫—Å–µ–ª–µ–π
6. –ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–æ–≤—ã–π yaw –≤ F3
""")

input("‚ñ∂Ô∏è  Enter –∫–æ–≥–¥–∞ —Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ –°–ï–í–ï–† (yaw=180¬∞)...")

print(f"\n‚è≥ –ü–µ—Ä–µ–∫–ª—é—á–∞–π—Å—è –Ω–∞ Minecraft!")
for i in range(3, 0, -1):
    print(f"   {i}...")
    time.sleep(1)

print(f"\nüîÑ –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞—é –Ω–∞ {TEST_PIXELS} –ø–∏–∫—Å–µ–ª–µ–π –≤–ø—Ä–∞–≤–æ...")
pico.mouse_move(TEST_PIXELS, 0)

time.sleep(0.5)
pico.close()

print(f"""
üìä –†–ï–ó–£–õ–¨–¢–ê–¢:
   –ë—ã–ª–æ: yaw = 180¬∞
   –ü–∏–∫—Å–µ–ª–µ–π: {TEST_PIXELS}
   
   –ü–æ—Å–º–æ—Ç—Ä–∏ yaw –≤ F3 –∏ –≤–≤–µ–¥–∏ –µ–≥–æ:
""")

try:
    yaw_input = input("   –ù–æ–≤—ã–π yaw: ").strip().replace(',', '.')
    new_yaw = float(yaw_input)
except:
    print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥")
    exit()

# –°—á–∏—Ç–∞–µ–º —Å–∫–æ–ª—å–∫–æ –≥—Ä–∞–¥—É—Å–æ–≤ –ø–æ–≤–µ—Ä–Ω—É–ª–æ—Å—å
turned = 180 - new_yaw
if turned < 0:
    turned += 360
if turned > 360:
    turned -= 360

print(f"\n   –ü–æ–≤–µ—Ä–Ω—É–ª–æ—Å—å: {turned:.1f}¬∞")

# –°—á–∏—Ç–∞–µ–º –ø–∏–∫—Å–µ–ª–∏ –Ω–∞ 90¬∞
pixels_per_90 = (TEST_PIXELS / turned) * 90

print(f"""
{'='*50}
‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢ –ö–ê–õ–ò–ë–†–û–í–ö–ò:

   MOUSE_SENSITIVITY = {pixels_per_90:.0f}
   
   (–ø–∏–∫—Å–µ–ª–µ–π –¥–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –Ω–∞ 90¬∞)
{'='*50}

–í—Å—Ç–∞–≤—å —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ play.py!
""")